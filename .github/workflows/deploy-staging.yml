name: Deploy Staging

on:
  push:
    branches: [ 'staging' ]

permissions:
  contents: read

jobs:
  build-and-deploy:
    name: Test and Deploy to Vercel (staging)
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Use Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Run tests
        run: npm test

      - name: Deploy to Vercel (via CLI)
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
        run: |
          # Asegúrate de definir el secret VERCEL_TOKEN en el repositorio
          # El comando desplegará el proyecto con el nombre `vasoliapi-staging`.
          npx vercel --token $VERCEL_TOKEN --confirm --prod --name vasoliapi-staging

      - name: Show deployment URL
        if: success()
        run: |
          echo "Despliegue finalizado. Revisa los logs de Vercel para la URL del deployment."
